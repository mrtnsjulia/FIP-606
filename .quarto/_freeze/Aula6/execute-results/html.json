{
  "hash": "c53f16e91b4137df661f5085990d0d3b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aula 6\"\nformat: html\neditor: visual\n---\n\n\n## Aula 6\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\ninsects <- InsectSprays\n\nm1 <- lm(count ~ spray, data = insects)\n\nlibrary(DHARMa)\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-1-1.png){width=1344}\n:::\n\n```{.r .cell-code}\n#não atendeu ao pressuposto de homogeneidade então fizemos transformação dos dados primeiro por raiz quadrada. \n\nm1 <- lm(sqrt(count) ~ spray, data = insects)\nm1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = sqrt(count) ~ spray, data = insects)\n\nCoefficients:\n(Intercept)       sprayB       sprayC       sprayD       sprayE       sprayF  \n     3.7607       0.1160      -2.5158      -1.5963      -1.9512       0.2579  \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-1-2.png){width=1344}\n:::\n\n```{.r .cell-code}\n#depois fizemos transformação por log - +1 para evitar log 0\nm1_log <- lm(log(count + 1) ~ spray, data = insects)\nm1_log\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = log(count + 1) ~ spray, data = insects)\n\nCoefficients:\n(Intercept)       sprayB       sprayC       sprayD       sprayE       sprayF  \n     2.6967       0.0598      -1.7441      -0.9834      -1.2705       0.1189  \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m1_log))\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-1-3.png){width=1344}\n:::\n\n```{.r .cell-code}\nboxcox(lm(insects$count + 0.1 ~ 1))\nb<- boxcox(lm(insects$count + 0.1 ~ 1))\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-1-4.png){width=1344}\n:::\n\n```{.r .cell-code}\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4242424\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\ninsects <- insects |>\n  mutate(count2 = count^lambda-1/lambda) |>\n  mutate(count3 = sqrt(count))\n\ninsects$count2<- (insects$count ^ lambda - 1) / lambda\nhist(insects$count2)\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-1-5.png){width=1344}\n:::\n:::\n\n\n##### Aqui carregamos o conjunto de dados InsectSprays e ajustamos um modelo linear para verificar o efeito do tipo de inseticida sobre a contagem de insetos mortos. Em seguida, utilizamos o pacote DHARMa para avaliar os resíduos do modelo e verificamos possíveis desvios da normalidade. Depois aplicamos a transformação de Box-Cox, para melhorar a adequação do modelo e identificando o melhor valor de lambda. Também testamos a transformação por raiz quadrada para comparação.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\n\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=401662555#gid=401662555\")\n\nlibrary(ggplot2)\n estande |> ggplot(aes(trat, nplants)) + geom_point() + geom_smooth(method = \"lm\", se = FALSE) +\n   facet_wrap( ~ exp) +\n   theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-2-1.png){width=1344}\n:::\n:::\n\n\n##### Aqui importamos e fizemos a visualização dos dados relacionados à emergência de plantas em função da porcentagem de inóculo nas sementes. utilizamos o ggplot2 para criar gráficos de dispersão entre o tratamento (trat) e o número de plantas emergidas (nplants), separando os gráficos por experimento (exp). Também adicionamos uma linha de tendência linear para facilitar a visualização do comportamento dos dados em cada experimento.\n\n##### \n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp1 <- estande |>\n  filter(exp == 1)\nm_exp1 <- lm(nplants ~ trat, data = exp1)\nsummary(m_exp1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp1)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.500  -6.532   1.758   8.573  27.226 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15 on 22 degrees of freedom\nMultiple R-squared:  0.07148,\tAdjusted R-squared:  0.02928 \nF-statistic: 1.694 on 1 and 22 DF,  p-value: 0.2066\n```\n\n\n:::\n\n```{.r .cell-code}\nexp2 <- estande |>\n  filter(exp == 2)\nm_exp2 <- lm(nplants ~ trat, data = exp2)\nsummary(m_exp2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7816  -7.7150   0.5653   8.1929  19.2184 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     3.6304  16.798 4.93e-14 ***\ntrat         -0.7007     0.1605  -4.365 0.000247 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.95 on 22 degrees of freedom\nMultiple R-squared:  0.4641,\tAdjusted R-squared:  0.4398 \nF-statistic: 19.05 on 1 and 22 DF,  p-value: 0.0002473\n```\n\n\n:::\n\n```{.r .cell-code}\nexp3 <- estande |>\n  filter(exp == 3)\nm_exp3 <- lm(nplants ~ trat, data = exp3)\nsummary(m_exp3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp3)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-26.5887  -3.9597   0.7177   5.5806  19.8952 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  95.7500     2.9529  32.425  < 2e-16 ***\ntrat         -0.7634     0.1306  -5.847 6.97e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.53 on 22 degrees of freedom\nMultiple R-squared:  0.6085,\tAdjusted R-squared:  0.5907 \nF-statistic: 34.19 on 1 and 22 DF,  p-value: 6.968e-06\n```\n\n\n:::\n:::\n\n\n##### Aqui realizamos análises para cada um dos experimentos da planilha importada anteriormente. Filtramos os dados por experimento e ajustamos modelos lineares para avaliar a relação entre o percentual de inóculo (trat) e o número de plantas emergidas (nplants). Para cada experimento, usamos a função lm() e analisamos os resultados por meio do summary(), permitindo identificar a significância e o efeito do tratamento em cada caso específico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nm_misto <- lmer(nplants ~ trat + (1 | exp/bloco), data = estande)\nsummary(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: nplants ~ trat + (1 | exp/bloco)\n   Data: estande\n\nREML criterion at convergence: 575.8\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.21697 -0.63351  0.04292  0.67094  1.92907 \n\nRandom effects:\n Groups    Name        Variance Std.Dev.\n bloco:exp (Intercept)  54.76    7.40   \n exp       (Intercept) 377.43   19.43   \n Residual              134.99   11.62   \nNumber of obs: 72, groups:  bloco:exp, 12; exp, 3\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept) 69.74524   11.57191   6.027\ntrat        -0.56869    0.08314  -6.840\n\nCorrelation of Fixed Effects:\n     (Intr)\ntrat -0.111\n```\n\n\n:::\n\n```{.r .cell-code}\nconfint(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 2.5 %     97.5 %\n.sig01       3.3332097 14.4218422\n.sig02       7.2377419 47.8269818\n.sigma       9.7314178 13.9359486\n(Intercept) 43.4631239 96.0274587\ntrat        -0.7328972 -0.4044812\n```\n\n\n:::\n\n```{.r .cell-code}\ncar::Anova(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: nplants\n      Chisq Df Pr(>Chisq)    \ntrat 46.788  1  7.909e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nestande |>\n  ggplot(aes(trat, nplants, color = factor(exp))) +\n  geom_point()+\n  #geom_smooth(method = \"lm\", se = FALSE) +\n  geom_abline(intercept = 69.74, \n              slope = -0.568, linewidth = 2) +\n  geom_abline(intercept = 43,\n              slope = -0.73, linetype =\"dashed\") +\n    geom_abline(intercept = 96,\n              slope = -0.40, linetype =\"dashed\")\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-4-1.png){width=1344}\n:::\n:::\n\n\n##### Aqui realizamos uma análise com modelo misto para considerar variações entre experimentos e blocos. Fizemos isso ajustando um **modelo misto linear** com o pacote **lme4**, considerando o efeito fixo do tratamento (`trat`) e os efeitos aleatórios dos blocos dentro dos experimentos (`(1 | exp/bloco)`). Avaliamos o modelo com `summary()`, obtivemos os intervalos de confiança dos parâmetros com `confint()` e testamos a significância dos efeitos com a função `Anova()` do pacote **car**. Por fim, criamos um gráfico com os pontos dos dados coloridos por experimento e adicionamos retas com diferentes interceptos e inclinações para representar tendências gerais e específicas, comparando possíveis ajustes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nfungi <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=465348652#gid=465348652\")\n\nfungi |>\n  group_by(code, dose)  |>\n  summarise(germination = mean(germination)) |> \n             ggplot(aes(dose, germination)) + geom_point() +\n  geom_line() +\n  facet_wrap(~ code)\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-5-1.png){width=1344}\n:::\n\n```{.r .cell-code}\nFGT43 <- fungi |>\n  group_by(code, dose) |>\n  summarise(germination = mean(germination)) |>\n  filter (code == \"FGT43\")\n\nlibrary(drc)\nm43 <- drm(germination ~ dose, data = FGT43,\n           fct = LL.3())\nsummary(m43)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nModel fitted: Log-logistic (ED50 as parameter) with lower limit at 0 (3 parms)\n\nParameter estimates:\n\n               Estimate Std. Error t-value   p-value    \nb:(Intercept)  1.219692   0.175081  6.9664  0.006069 ** \nd:(Intercept) 48.486911   1.456007 33.3013 5.952e-05 ***\ne:(Intercept)  0.495895   0.060851  8.1494  0.003864 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error:\n\n 1.636105 (3 degrees of freedom)\n```\n\n\n:::\n\n```{.r .cell-code}\nAIC(m43)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 26.7762\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(m43)\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-5-2.png){width=1344}\n:::\n\n```{.r .cell-code}\nED(m43, 50)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nEstimated effective doses\n\n       Estimate Std. Error\ne:1:50 0.495895   0.060851\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ec50estimator)\ndf_ec50 = estimate_EC50(germination ~ dose,\n                        data = fungi,\n                        isolate_col = \"code\",\n                        strata_col = \"state\",\n                        interval = \"delta\",\n                        fct = drc :: LL.3())\ndf_ec50 |>\n  ggplot(aes(reorder(ID, Estimate), Estimate)) +\n  geom_point()+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-5-3.png){width=1344}\n:::\n\n```{.r .cell-code}\ndf_ec50 |>\n  ggplot(aes(x = Estimate)) +\n  geom_histogram(bins = 5, color = \"white\")\n```\n\n::: {.cell-output-display}\n![](Aula6_files/figure-html/unnamed-chunk-5-4.png){width=1344}\n:::\n:::\n\n\n##### Aqui importamos os dados de germinação de esporos de diferentes isolados sob diferentes doses de tratamento, depois calculamos a média de germinação por isolado e dose e visualizamos os resultados com gráficos de dispersão e linhas. Selecionamos o isolado FGT43 e ajustamos um modelo não linear com o pacote drc, estimando a EC50 e visualizando o ajuste. Em seguida, utilizamos o pacote ec50estimator para estimar a EC50 de todos os isolados ao mesmo tempo, por estado. Por fim, apresentamos os resultados em gráfico de pontos ordenados e histograma das EC50s para avaliar a variabilidade entre os isolados.\n",
    "supporting": [
      "Aula6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}