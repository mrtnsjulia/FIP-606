{
  "hash": "d047022bd02fc2716f448db272a1dfa3",
  "result": {
    "engine": "knitr",
    "markdown": "## Aula 5\n\nPacotes utilizados nessa aula\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(tidyverse)\nlibrary(Hmisc)\nlibrary(multcomp)\nlibrary(emmeans)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=866852711#gid=866852711\")\nview(campo)\ncampo |> \n  ggplot(aes(TRAT, PROD))+\n  geom_jitter(width = 0.1)+\n  stat_summary(\n    fun.data = \"mean_cl_boot\",\n    colour=\"red\", width = 0.3)\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-2-1.png){width=1344}\n:::\n\n```{.r .cell-code}\ncampo$TRAT <- factor (campo$TRAT)\ncampo$BLOCO <- factor (campo$BLOCO)\n\nm_campo <- lm(PROD ~ BLOCO + TRAT, data = campo)\nm_campo\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = PROD ~ BLOCO + TRAT, data = campo)\n\nCoefficients:\n(Intercept)       BLOCO2       BLOCO3       BLOCO4        TRAT2        TRAT3  \n     4312.1       -156.4        -99.5       -115.4        715.8        890.8  \n      TRAT4        TRAT5        TRAT6        TRAT7        TRAT8  \n      921.0        902.8       1037.0        908.3        859.0  \n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m_campo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: PROD\n          Df  Sum Sq Mean Sq F value  Pr(>F)  \nBLOCO      3  105665   35222  0.2171 0.88340  \nTRAT       7 2993906  427701  2.6367 0.04021 *\nResiduals 21 3406431  162211                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nmeans_campo <- emmeans(m_campo, ~ TRAT)\nmeans_campo\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TRAT emmean  SE df lower.CL upper.CL\n 1      4219 201 21     3800     4638\n 2      4935 201 21     4516     5354\n 3      5110 201 21     4691     5529\n 4      5140 201 21     4721     5559\n 5      5122 201 21     4703     5541\n 6      5256 201 21     4837     5675\n 7      5128 201 21     4709     5546\n 8      5078 201 21     4659     5497\n\nResults are averaged over the levels of: BLOCO \nConfidence level used: 0.95 \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(means_campo)\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-2-2.png){width=1344}\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\ncld(means_campo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TRAT emmean  SE df lower.CL upper.CL .group\n 1      4219 201 21     3800     4638  1    \n 2      4935 201 21     4516     5354  12   \n 8      5078 201 21     4659     5497  12   \n 3      5110 201 21     4691     5529  12   \n 5      5122 201 21     4703     5541  12   \n 7      5128 201 21     4709     5546  12   \n 4      5140 201 21     4721     5559  12   \n 6      5256 201 21     4837     5675   2   \n\nResults are averaged over the levels of: BLOCO \nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 8 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\nm_campo <- lm(log(FER) ~ BLOCO + TRAT, data = campo)\nm_campo\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = log(FER) ~ BLOCO + TRAT, data = campo)\n\nCoefficients:\n(Intercept)       BLOCO2       BLOCO3       BLOCO4        TRAT2        TRAT3  \n     3.1347      -0.1964      -0.1878      -0.1675      -1.2600      -1.6600  \n      TRAT4        TRAT5        TRAT6        TRAT7        TRAT8  \n    -1.8718      -1.8211      -1.9052      -1.7825      -1.7491  \n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m_campo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: log(FER)\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nBLOCO      3  0.2064 0.06880  1.7961    0.1788    \nTRAT       7 11.5210 1.64585 42.9665 4.838e-11 ***\nResiduals 21  0.8044 0.03831                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m_campo))\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-2-3.png){width=1344}\n:::\n\n```{.r .cell-code}\nmeans_campo <- emmeans(m_campo, ~ TRAT, type = \"response\")\nmeans_campo\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TRAT response    SE df lower.CL upper.CL\n 1       20.02 1.960 21    16.33    24.54\n 2        5.68 0.556 21     4.63     6.96\n 3        3.81 0.373 21     3.11     4.67\n 4        3.08 0.301 21     2.51     3.78\n 5        3.24 0.317 21     2.64     3.97\n 6        2.98 0.292 21     2.43     3.65\n 7        3.37 0.330 21     2.75     4.13\n 8        3.48 0.341 21     2.84     4.27\n\nResults are averaged over the levels of: BLOCO \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(means_campo)\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-2-4.png){width=1344}\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\ncld(means_campo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TRAT response    SE df lower.CL upper.CL .group\n 6        2.98 0.292 21     2.43     3.65  1    \n 4        3.08 0.301 21     2.51     3.78  1    \n 5        3.24 0.317 21     2.64     3.97  1    \n 7        3.37 0.330 21     2.75     4.13  1    \n 8        3.48 0.341 21     2.84     4.27  1    \n 3        3.81 0.373 21     3.11     4.67  12   \n 2        5.68 0.556 21     4.63     6.96   2   \n 1       20.02 1.960 21    16.33    24.54    3  \n\nResults are averaged over the levels of: BLOCO \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 8 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\npwpm(means_campo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        1       2       3       4       5       6       7       8\n1 [20.02]  <.0001  <.0001  <.0001  <.0001  <.0001  <.0001  <.0001\n2   3.525 [ 5.68]  0.1252  0.0048  0.0110  0.0028  0.0204  0.0343\n3   5.259   1.492 [ 3.81]  0.7832  0.9335  0.6440  0.9843  0.9976\n4   6.500   1.844   1.236 [ 3.08]  0.9999  1.0000  0.9976  0.9842\n5   6.178   1.753   1.175   0.951 [ 3.24]  0.9984  1.0000  0.9994\n6   6.721   1.906   1.278   1.034   1.088 [ 2.98]  0.9842  0.9431\n7   5.945   1.686   1.130   0.915   0.962   0.885 [ 3.37]  1.0000\n8   5.750   1.631   1.093   0.885   0.931   0.856   0.967 [ 3.48]\n\nRow and column labels: TRAT\nUpper triangle: P values   null = 1  adjust = \"tukey\"\nDiagonal: [Estimates] (response)   type = \"response\"\nLower triangle: Comparisons (ratio)   earlier vs. later\n```\n\n\n:::\n:::\n\n\n##### Aqui nós importamos os dados da planilha compartilhada pelo professor, depois visualizamos os dados usando um gráfico de dispersão com intervalos de confiança, o que mostra as diferenças de produtividade e entre os tratamentos. Convertemos as variáveis TRAT e BLOCO em fatores e, em seguida, ajustamos a ANOVA usando lm(PROD \\~ BLOCO + TRAT) para avaliar o efeito dos tratamentos, considerando os blocos como fator de controle. Aplicamos a função anova() para verificar a significância das diferenças.\n\n##### Utilizamos o pacote emmeans para estimar as médias ajustadas dos tratamentos e o cld() para realizar comparações múltiplas, identificando quais tratamentos diferem entre si estatisticamente. Depois avaliamos a variável FER, e ela não atendeu aos pressupostos do modelo, aplicamos uma transformação logarítmica. Ajustamos novamente o modelo e usamos o pacote DHARMa para verificar os resíduos simulados. E terminamos calculando as médias ajustadas transformadas de volta à escala original (type = \"response\") e realizamos novas comparações com cld() e pwpm(), para verificar quais tratamentos apresentaram diferenças significativas em relação à fertilidade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmilho <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=1345524759#gid=1345524759\")\nview(milho)\n\nmilho |> \n  ggplot(aes(hybrid, index, color = method))+\n  geom_jitter(width = 0.1)+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-3-1.png){width=1344}\n:::\n\n```{.r .cell-code}\nmilho$hybrid_block <- interaction(milho$hybrid, milho$block)\n\nlibrary(dplyr)\nmilho |> \n  mutate(hybrid_block = interaction(hybrid, block))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 48 × 6\n   hybrid   block method index yield hybrid_block\n   <chr>    <dbl> <chr>  <dbl> <dbl> <fct>       \n 1 30F53 HX     1 pin     21.1 12920 30F53 HX.1  \n 2 30F53 HX     2 pin     21.1  9870 30F53 HX.2  \n 3 30F53 HX     3 pin     23.3  8920 30F53 HX.3  \n 4 30F53 HX     4 pin     35.6 13120 30F53 HX.4  \n 5 30F53 YH     1 pin     21.1 12060 30F53 YH.1  \n 6 30F53 YH     2 pin     22.2  7860 30F53 YH.2  \n 7 30F53 YH     3 pin     27.3  7410 30F53 YH.3  \n 8 30F53 YH     4 pin     27.8 10300 30F53 YH.4  \n 9 30K64        1 pin     20   11700 30K64.1     \n10 30K64        2 pin     20   10700 30K64.2     \n# ℹ 38 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nlibrary(lme4)\nm_milho <- lmer(index ~ hybrid*method + \n                  (1 | block:hybrid_block),\n                data = milho)\ncar::Anova(m_milho)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: index\n                Chisq Df Pr(>Chisq)   \nhybrid        11.4239  5    0.04359 * \nmethod         4.6964  1    0.03023 * \nhybrid:method 15.8062  5    0.00742 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(m_milho))\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-3-2.png){width=1344}\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\nmedia_milho <- emmeans(m_milho, ~ hybrid | method)\ncld (media_milho, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nmethod = pin:\n hybrid   emmean   SE   df lower.CL upper.CL .group\n BG7049H    19.4 3.57 24.9     12.1     26.8  a    \n 30K64      20.6 3.57 24.9     13.2     27.9  a    \n 30F53 YH   24.6 3.57 24.9     17.3     31.9  ab   \n 30F53 HX   25.3 3.57 24.9     17.9     32.6  ab   \n 30S31YH    32.5 3.57 24.9     25.2     39.8  ab   \n 30S31H     38.1 3.57 24.9     30.8     45.4   b   \n\nmethod = silk:\n hybrid   emmean   SE   df lower.CL upper.CL .group\n BG7049H    19.2 3.57 24.9     11.8     26.5  a    \n 30K64      21.5 3.57 24.9     14.2     28.8  a    \n 30F53 HX   25.0 3.57 24.9     17.7     32.3  a    \n 30F53 YH   26.2 3.57 24.9     18.9     33.6  a    \n 30S31H     26.5 3.57 24.9     19.2     33.8  a    \n 30S31YH    26.6 3.57 24.9     19.3     34.0  a    \n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\nm_milho3 <- lmer(yield ~ hybrid*method + \n                  (1 | block:hybrid_block),\n                data = milho)\ncar::Anova(m_milho3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: yield\n                Chisq Df Pr(>Chisq)    \nhybrid        22.5966  5  0.0004031 ***\nmethod         0.1052  1  0.7456932    \nhybrid:method 25.9302  5  9.206e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(m_milho3))\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-3-3.png){width=1344}\n:::\n:::\n\n\n##### Aqui Importamos os dados do experimento com milho e visualizamos a variável index por híbrido e método. Criamos a variável hybrid_block para representar a interação entre híbrido e bloco, usada na modelagem mista com lmer(), considerando index como resposta e block:hybrid_block como efeito aleatório. Avaliamos os resíduos simulados com o pacote DHARMa e, com emmeans, estimamos as médias ajustadas dos híbridos por método, comparando-as com cld(). Repetimos o processo para a variável yield, ajustando novo modelo misto e verificando a qualidade do ajuste da mesma forma.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nmilho |> \n  ggplot(aes(index,  yield))+\n  geom_point()+\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](Aula5_files/figure-html/unnamed-chunk-4-1.png){width=1344}\n:::\n\n```{.r .cell-code}\ncor1 <- cor.test(milho$index, milho$yield)\nR2_percentual <- (cor1$estimate)^2 * 100\nR2_percentual*100\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     cor \n632.3713 \n```\n\n\n:::\n:::\n\n\n##### Aqui criamos um gráfico de dispersão com linha de tendência linear entre index e yield. Em seguida, calculamos a correlação entre as duas variáveis e obtivemos o R² percentual, que indica o quanto index explica a variação em yield.\n",
    "supporting": [
      "Aula5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}